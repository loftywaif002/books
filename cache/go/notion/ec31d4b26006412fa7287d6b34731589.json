{
  "ID": "ec31d4b2-6006-412f-a728-7d6b34731589",
  "Root": {
    "alive": true,
    "content": [
      "7285ed1c-8389-43f9-b27e-9d6694507947",
      "110b3075-4d97-4937-a753-50ac5abece4a",
      "8544c0b2-b07a-4147-b715-2ce5ee540828",
      "1ea540bb-21f3-47ce-91ac-c1988a39fee8",
      "e7307a9d-5230-44a5-a9c8-ba4ecf2426d2",
      "533b1ba8-4a93-41fb-9e56-8c796a2d1631",
      "c87f945d-5904-455a-b61d-8be45eae98bb",
      "349b3be4-fe79-43a1-96f2-30cc75a3a7c4",
      "00838bc6-46bc-4f9c-bb4f-fb534d4575d0",
      "eea57e50-6c8e-46c1-bd98-ef74715e653e",
      "9fe595cb-e614-491e-bd4d-aa02e1a3120a",
      "cf939c79-1ac7-40df-b405-2d5f1411f93f",
      "63ea9e2c-1ec0-44e4-8cd9-fc5e70e8fe47",
      "a880b7d3-b143-4e51-a29d-a5514e98fedb",
      "7a050fff-add0-4778-8b45-315756c4a195",
      "a66d10df-e3b7-46f1-8d99-c2d15f38b0fc",
      "f717d873-ee7d-4691-a5ed-b4ef8e77f2dc",
      "1c221390-acfb-45b5-b8d4-c30e7f32f08c",
      "1b73cd61-c50c-4917-8e41-d49c8fe52954",
      "7d44be2b-ba84-4a5a-8bb4-486d86abb639"
    ],
    "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
    "created_time": 1532156055187,
    "format": {
      "page_full_width": true,
      "page_small_text": true
    },
    "id": "ec31d4b2-6006-412f-a728-7d6b34731589",
    "ignore_block_count": true,
    "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
    "last_edited_time": 1539837842736,
    "parent_id": "20bfd8fa-4545-4479-954a-6814eeeef716",
    "parent_table": "block",
    "properties": {
      "title": [
        [
          "Defer gotchas"
        ]
      ]
    },
    "type": "page",
    "version": 71,
    "content_resolved": [
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532205344956,
        "id": "7285ed1c-8389-43f9-b27e-9d6694507947",
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1532236192809,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "$Search: Defer pitfalls"
            ]
          ]
        },
        "type": "text",
        "version": 12,
        "inline_content": [
          {
            "Text": "$Search: Defer pitfalls"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532205348889,
        "id": "110b3075-4d97-4937-a753-50ac5abece4a",
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1532236193506,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "$Id: 130"
            ]
          ]
        },
        "type": "text",
        "version": 12,
        "inline_content": [
          {
            "Text": "$Id: 130"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532205350440,
        "id": "8544c0b2-b07a-4147-b715-2ce5ee540828",
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1532236194519,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "$SOId: rd6000ub"
            ]
          ]
        },
        "type": "text",
        "version": 12,
        "inline_content": [
          {
            "Text": "$SOId: rd6000ub"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532205352240,
        "id": "1ea540bb-21f3-47ce-91ac-c1988a39fee8",
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1532205352767,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "type": "text",
        "version": 10
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532156055183,
        "id": "e7307a9d-5230-44a5-a9c8-ba4ecf2426d2",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1539837857814,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "When using "
            ],
            [
              "defer",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " keep the following in mind: "
            ],
            [
              "deferred functions are called at the end of a function",
              [
                [
                  "b"
                ]
              ]
            ],
            [
              "."
            ]
          ]
        },
        "type": "text",
        "version": 51,
        "inline_content": [
          {
            "Text": "When using "
          },
          {
            "Text": "defer",
            "AttrFlags": 2
          },
          {
            "Text": " keep the following in mind: "
          },
          {
            "Text": "deferred functions are called at the end of a function",
            "AttrFlags": 1
          },
          {
            "Text": "."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532156055183,
        "id": "533b1ba8-4a93-41fb-9e56-8c796a2d1631",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1532156055183,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Deferred statements have a function scope, not a block scope."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "Deferred statements have a function scope, not a block scope."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532156055183,
        "id": "c87f945d-5904-455a-b61d-8be45eae98bb",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1538785823202,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "In other words: deferred calls are executed when exiting a function not when executing block created with "
            ],
            [
              "if",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " or "
            ],
            [
              "for",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " statements."
            ]
          ]
        },
        "type": "text",
        "version": 3,
        "inline_content": [
          {
            "Text": "In other words: deferred calls are executed when exiting a function not when executing block created with "
          },
          {
            "Text": "if",
            "AttrFlags": 2
          },
          {
            "Text": " or "
          },
          {
            "Text": "for",
            "AttrFlags": 2
          },
          {
            "Text": " statements."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1539837705137,
        "format": {
          "block_width": 800,
          "block_height": 600,
          "display_source": "https://repl.it/@kjk1/gobook-defer-gotcha?lite=true",
          "block_full_width": false,
          "block_page_width": true,
          "block_preserve_scale": false
        },
        "id": "349b3be4-fe79-43a1-96f2-30cc75a3a7c4",
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1539837706646,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "source": [
            [
              "https://repl.it/@kjk1/gobook-defer-gotcha"
            ]
          ]
        },
        "type": "embed",
        "version": 8,
        "source": "https://repl.it/@kjk1/gobook-defer-gotcha",
        "format_embed": {
          "block_full_width": false,
          "block_height": 600,
          "block_page_width": true,
          "block_preserve_scale": false,
          "display_source": "https://repl.it/@kjk1/gobook-defer-gotcha?lite=true"
        }
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532156055184,
        "id": "00838bc6-46bc-4f9c-bb4f-fb534d4575d0",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1532156055184,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "You might expect that deferred statement to be executed when we exit "
            ],
            [
              "if",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " branch but it’s executed as the last thing in a function."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "You might expect that deferred statement to be executed when we exit "
          },
          {
            "Text": "if",
            "AttrFlags": 2
          },
          {
            "Text": " branch but it’s executed as the last thing in a function."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532156055184,
        "id": "eea57e50-6c8e-46c1-bd98-ef74715e653e",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1538896494562,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Using outside variables in defer functions"
            ]
          ]
        },
        "type": "sub_header",
        "version": 115,
        "inline_content": [
          {
            "Text": "Using outside variables in defer functions"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1539837763438,
        "format": {
          "block_width": 800,
          "block_height": 600,
          "display_source": "https://repl.it/@kjk1/gobook-defer-gotcha-2?lite=true",
          "block_full_width": false,
          "block_page_width": true,
          "block_preserve_scale": false
        },
        "id": "9fe595cb-e614-491e-bd4d-aa02e1a3120a",
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1539837765194,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "source": [
            [
              "https://repl.it/@kjk1/gobook-defer-gotcha-2"
            ]
          ]
        },
        "type": "embed",
        "version": 8,
        "source": "https://repl.it/@kjk1/gobook-defer-gotcha-2",
        "format_embed": {
          "block_full_width": false,
          "block_height": 600,
          "block_page_width": true,
          "block_preserve_scale": false,
          "display_source": "https://repl.it/@kjk1/gobook-defer-gotcha-2?lite=true"
        }
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532156055185,
        "id": "cf939c79-1ac7-40df-b405-2d5f1411f93f",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1538896582963,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "A common mistake is to think that this code will print "
            ],
            [
              "0",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " and "
            ],
            [
              "1",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              ". Those are the values of "
            ],
            [
              "i",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " when we see "
            ],
            [
              "defer",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              "."
            ]
          ]
        },
        "type": "text",
        "version": 160,
        "inline_content": [
          {
            "Text": "A common mistake is to think that this code will print "
          },
          {
            "Text": "0",
            "AttrFlags": 2
          },
          {
            "Text": " and "
          },
          {
            "Text": "1",
            "AttrFlags": 2
          },
          {
            "Text": ". Those are the values of "
          },
          {
            "Text": "i",
            "AttrFlags": 2
          },
          {
            "Text": " when we see "
          },
          {
            "Text": "defer",
            "AttrFlags": 2
          },
          {
            "Text": "."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1538896552167,
        "id": "63ea9e2c-1ec0-44e4-8cd9-fc5e70e8fe47",
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1538896781135,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "However, "
            ],
            [
              "defer",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " creates a closure which only captures variable "
            ],
            [
              "i",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " by a reference. It doesn't capture the value of the variable."
            ]
          ]
        },
        "type": "text",
        "version": 569,
        "inline_content": [
          {
            "Text": "However, "
          },
          {
            "Text": "defer",
            "AttrFlags": 2
          },
          {
            "Text": " creates a closure which only captures variable "
          },
          {
            "Text": "i",
            "AttrFlags": 2
          },
          {
            "Text": " by a reference. It doesn't capture the value of the variable."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532156055185,
        "id": "a880b7d3-b143-4e51-a29d-a5514e98fedb",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1538896917163,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "It should be become clear when we look at what code executes:"
            ]
          ]
        },
        "type": "text",
        "version": 315,
        "inline_content": [
          {
            "Text": "It should be become clear when we look at what code executes:"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532156055185,
        "id": "7a050fff-add0-4778-8b45-315756c4a195",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1538897060370,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Go"
            ]
          ],
          "title": [
            [
              "var i int\nfor i = 0; i \u003c 2; i++ {\n\t// create closure that references i by reference\n}\n\nfmt.Printf(\"%d\\n\", i) // from created by defer in second loop iteration (remember: reverse order)\nfmt.Printf(\"%d\\n\", i) // from closure created by defer in first loop iteration"
            ]
          ]
        },
        "type": "code",
        "version": 513,
        "code": "var i int\nfor i = 0; i \u003c 2; i++ {\n\t// create closure that references i by reference\n}\n\nfmt.Printf(\"%d\\n\", i) // from created by defer in second loop iteration (remember: reverse order)\nfmt.Printf(\"%d\\n\", i) // from closure created by defer in first loop iteration",
        "code_language": "Go"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532156055185,
        "id": "a66d10df-e3b7-46f1-8d99-c2d15f38b0fc",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1532156055185,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Now it’s clear that when we call deferred "
            ],
            [
              "fmt.Printf",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              ", "
            ],
            [
              "i",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " is "
            ],
            [
              "2",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              "."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "Now it’s clear that when we call deferred "
          },
          {
            "Text": "fmt.Printf",
            "AttrFlags": 2
          },
          {
            "Text": ", "
          },
          {
            "Text": "i",
            "AttrFlags": 2
          },
          {
            "Text": " is "
          },
          {
            "Text": "2",
            "AttrFlags": 2
          },
          {
            "Text": "."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532156055186,
        "id": "f717d873-ee7d-4691-a5ed-b4ef8e77f2dc",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1538896420341,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "We can fix this by forcing a capture of the variable:"
            ]
          ]
        },
        "type": "text",
        "version": 177,
        "inline_content": [
          {
            "Text": "We can fix this by forcing a capture of the variable:"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1539837814874,
        "format": {
          "block_width": 800,
          "block_height": 600,
          "display_source": "https://repl.it/@kjk1/gobook-defer-gotcha-3?lite=true",
          "block_full_width": false,
          "block_page_width": true,
          "block_preserve_scale": false
        },
        "id": "1c221390-acfb-45b5-b8d4-c30e7f32f08c",
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1539837816624,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "source": [
            [
              "https://repl.it/@kjk1/gobook-defer-gotcha-3"
            ]
          ]
        },
        "type": "embed",
        "version": 8,
        "source": "https://repl.it/@kjk1/gobook-defer-gotcha-3",
        "format_embed": {
          "block_full_width": false,
          "block_height": 600,
          "block_page_width": true,
          "block_preserve_scale": false,
          "display_source": "https://repl.it/@kjk1/gobook-defer-gotcha-3?lite=true"
        }
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1532156055186,
        "id": "1b73cd61-c50c-4917-8e41-d49c8fe52954",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1538897139442,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "A closure might be slightly more expensive as it requires allocating an object to collect all the variables captured by the closure."
            ]
          ]
        },
        "type": "text",
        "version": 53,
        "inline_content": [
          {
            "Text": "A closure might be slightly more expensive as it requires allocating an object to collect all the variables captured by the closure."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1538897065623,
        "id": "7d44be2b-ba84-4a5a-8bb4-486d86abb639",
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1538897065623,
        "parent_id": "ec31d4b2-6006-412f-a728-7d6b34731589",
        "parent_table": "block",
        "type": "text",
        "version": 4
      }
    ],
    "title": "Defer gotchas",
    "format_page": {
      "page_cover": "",
      "page_cover_position": 0,
      "page_font": "",
      "page_full_width": true,
      "page_icon": "",
      "page_small_text": true
    }
  },
  "Users": [
    {
      "email": "kkowalczyk@gmail.com",
      "family_name": "Kowalczyk",
      "given_name": "Krzysztof",
      "id": "bb760e2d-d679-4b64-b2a9-03005b21870a",
      "locale": "en",
      "mobile_onboarding_completed": true,
      "onboarding_completed": true,
      "profile_photo": "https://s3-us-west-2.amazonaws.com/public.notion-static.com/2dcaa66c-7674-4ff6-9924-601785b63561/head-bw-640x960.png",
      "time_zone": "America/Los_Angeles",
      "version": 10
    }
  ],
  "Tables": null
}